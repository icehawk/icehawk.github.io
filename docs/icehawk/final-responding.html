<!doctype html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<title>Final responding | IceHawk | PHP micro-framework respecting CQRS</title>
	<meta name="description" content="IceHawk final responding - components documentation">
	<meta name="keywords" content="IceHawk, final, responder, documentation">
	<meta name="HandheldFriendly" content="True"/>
	<meta name="geo.region" content="DE-SN"/>
	<meta name="geo.placename" content="Dresden"/>
	<meta name="geo.position" content="51.052088;13.741672"/>
	<meta name="ICBM" content="51.052088, 13.741672"/>
	<meta name="twitter:site" content="https://twitter.com/hollodotme">
	<meta name="twitter:creator" content="@hollodotme">
	<script type="application/ld+json">{
  "@context" : "http://schema.org",
  "@type": "Person",
  "name": "IceHawk framework",
  "image": "https://icehawk.github.io/images/logo_121x100.png",
  "url": "https://icehawk.github.io",
  "sameAs" : [
      "https://twitter.com/hollodotme",
      "https://www.xing.com/profile/Holger_Woltersdorf",
      "https://github.com/icehawk"
    ]
  }
}</script>
	<meta property="article:author" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<meta property="article:publisher" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<link rel="apple-touch-icon" sizes="57x57" href="https://icehawk.github.io/images/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="https://icehawk.github.io/images/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="https://icehawk.github.io/images/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://icehawk.github.io/images/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="https://icehawk.github.io/images/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://icehawk.github.io/images/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="https://icehawk.github.io/images/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://icehawk.github.io/images/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://icehawk.github.io/images/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192" href="https://icehawk.github.io/images/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://icehawk.github.io/images/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="https://icehawk.github.io/images/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://icehawk.github.io/images/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://icehawk.github.io/images/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="https://icehawk.github.io/images/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">
	<link rel="canonical" href="https://icehawk.github.io/docs/icehawk/final-responding.html"/>
	<meta name="referrer" content="origin"/>

	<meta property="og:site_name" content="IceHawk | PHP micro-framework respecting CQRS"/>
	<meta property="og:type" content="article"/>
	<meta property="og:title" content="Final responding | IceHawk | PHP micro-framework respecting CQRS"/>
	<meta property="og:description" content="IceHawk final responding - components documentation"/>
	<meta property="og:url" content="https://icehawk.github.io/docs/icehawk/final-responding.html"/>
	<meta property="og:image" content="https://icehawk.github.io/images/logo_121x100.png"/>
	<meta property="article:published_time" content="2016-11-15T12:11:34+01:00"/>
	<meta property="article:modified_time" content="2016-11-15T12:11:34+01:00"/>
			<meta property="article:tag" content="IceHawk"/>
			<meta property="article:tag" content="final"/>
			<meta property="article:tag" content="responder"/>
			<meta property="article:tag" content="documentation"/>
		<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:title" content="Final responding | IceHawk | PHP micro-framework respecting CQRS"/>
	<meta name="twitter:description" content="IceHawk final responding - components documentation"/>
	<meta name="twitter:url" content="https://icehawk.github.io/docs/icehawk/final-responding.html"/>
	<meta name="twitter:image:src" content="https://icehawk.github.io/images/logo_121x100.png"/>

	<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "IceHawk framework",
    "author": {
        "@type": "Person",
        "name": "Holger Woltersdorf",
        "image": "https://icehawk.github.io/images/hwoltersdorf.png",
        "url": "https://github.com/hollodotme",
        "sameAs": "https://twitter.com/hollodotme",
        "description": "CIO at Fortuneglobe GmbH, Head of Fortune Solutions, Husband, Father, PHP Dev with heart, board member of PHP USERGROUP DRESDEN e.V."
    },
    "headline": "Final responding | IceHawk | PHP micro-framework respecting CQRS",
    "url": "https://icehawk.github.io/docs/icehawk/final-responding.html",
    "datePublished": "2016-11-15T12:11:34+01:00",
    "dateModified": "2016-11-15T12:11:34+01:00",
    "image": "https://icehawk.github.io/images/logo_121x100.png",
    "keywords": "IceHawk, final, responder, documentation",
    "description": "IceHawk final responding - components documentation"
}</script>

	<meta name="generator" content="IceHawk Static Page Generator"/>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://icehawk.github.io/css/webfont.css">
	<link rel="stylesheet" href="https://icehawk.github.io/css/prism.css">
	<link rel="stylesheet" href="https://icehawk.github.io/css/main.css">
</head>
<body>

<div class="page-container">

	<!-- top navbar -->
	<a class="navbar-brand" href="/">
		<img alt="IceHawk" src="https://icehawk.github.io/images/logo_121x100.png">
	</a>
	<div id="top-navigation" role="navigation">
		<div class="container">
			<div class="left-nav">
				<h3 class="visible-xs visible-sm hidden-md hidden-lg">
					<a href="#" data-toggle="offcanvas" data-target=".sidebar-nav">
						<i class="fa fa-bars"></i>
					</a>
				</h3>
				<h1 class="h4 hidden-xs hidden-sm visible-md visible-lg">
					<span class="brand">IceHawk framework</span><br>
					<small>A micro-framework respecting CQRS - written for PHP 7</small>
				</h1>
			</div>
			<div class="right-nav text-right">
				<ul class="hidden-xs hidden-sm">
					<li>
						<a href="https://gitter.im/icehawk/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge" target="_blank" title="Join our chat on Gitter">
							<img src="https://badges.gitter.im/icehawk/icehawk.svg" class="img-responsive">
						</a>
					</li>
					<li>
						<a href="https://github.com/icehawk/icehawk.github.io" target="_blank">
							Help us improve the docs
						</a>
					</li>
					<li>
						<a href="https://github.com/icehawk" target="_blank" title="Source code on github">
							<i class="fa fa-github"></i>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div id="top-fader"></div>

	<div class="container">

		<div class="row hidden-xs hidden-sm">

			<div class="col-md-12 col-lg-12">
				<ul class="breadcrumb hidden-xs hidden-sm">
											<li>
							<a href="https://icehawk.github.io/index.html">Home</a>
						</li>
											<li>
							<a href="https://icehawk.github.io/docs.html">Documentation</a>
						</li>
											<li>
							<a href="https://icehawk.github.io/docs/icehawk.html">IceHawk</a>
						</li>
											<li class="active">
							<a href="https://icehawk.github.io/docs/icehawk/final-responding.html">Final responding</a>
						</li>
									</ul>
			</div>

		</div>

		<div class="row row-offcanvas row-offcanvas-left">

			<!-- sidebar -->
			<div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
				<ul class="nav">
					
								<li class="active">
		<a href="https://icehawk.github.io/docs.html">Documentation</a>
					<ul class="nav">
															<li class="active">
		<a href="https://icehawk.github.io/docs/icehawk.html">IceHawk</a>
					<ul class="nav">
															<li>
		<a href="https://icehawk.github.io/docs/icehawk/installation.html">Installation</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/configuration.html">Configuration</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/delegation.html">Delegation</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/routing.html">Routing</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/request-information.html">Request information</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/request-input-data.html">Request input data</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/uploaded-files.html">Uploaded files</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/request-handlers.html">Request handlers</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/auto-responding.html">Auto responding</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/events-and-subscribers.html">Events and subscribers</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/exceptions.html">Exceptions</a>
			</li>

											<li class="active">
		<a href="https://icehawk.github.io/docs/icehawk/final-responding.html">Final responding</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/constants.html">Constants</a>
			</li>

							</ul>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/session.html">Session</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/forms.html">Forms</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/pubsub.html">PubSub</a>
			</li>

							</ul>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/guides.html">Guides</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/coverage.html">Code coverage</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/metrics.html">Metrics</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/media.html">Media</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/imprint.html">Imprint</a>
			</li>


									</ul>
			</div>

			<!-- main area -->
			<div class="col-xs-12 col-sm-9" id="mainstage">

				<h1>IceHawk final responding</h1>
<p>One of IceHawk's outstanding features is the delegation of thrown exceptions to so called final responders.
Final responders come in handy when you want a centralized and unified handling of uncaught exceptions. They also give you a last chance to provide a
valid response to the user / client. Furthermore you don't need to handle re-occurring exceptions in multiple request handlers by
duplicating your code.  </p>
<p><code>\Exception</code>s and <code>\Error</code>s (<code>\Throwable</code>s) are delegated to the appropriate final responder when they were thrown during the routing or request handling process.</p>
<hr class="blockspace">
<h2>Set up final responders</h2>
<p>Because the IceHawk component separates between read and write requests, we also offer to set up final responders for each side.
We ship two default final responders that do nothing, but throwing the passed <code>\Throwable</code> instance.</p>
<p>In the <a href="https://icehawk.github.io/docs/icehawk/configuration.html">IceHawk config</a> you are able to define your own final responders like this:</p>
<pre><code class="language-php">&lt;php declare(strict_types=1);

namespace YourVendor\YourProject;

use IceHawk\IceHawk\Interfaces\ConfiguresIceHawk;
use IceHawk\IceHawk\Interfaces\RespondsFinallyToReadRequest;
use IceHawk\IceHawk\Interfaces\RespondsFinallyToWriteRequest;

final class IceHawkConfig implements ConfiguresIceHawk
{
    # ...

    public function getFinalReadResponder() : RespondsFinallyToReadRequest
    {
        return new YourFinalReadResponder();
    }

    public function getFinalWriteResponder() : RespondsFinallyToWriteRequest
    {
        return new YourFinalWriteResponder();
    }
}</code></pre>
<hr class="blockspace">
<h2>Implementing final responders</h2>
<p>As you can see in the previous paragraph a final responder needs to implement the
<a href="https://github.com/icehawk/icehawk/blob/v2.0.4/src/Interfaces/RespondsFinallyToReadRequest.php">RespondsFinallyToReadRequest</a> resp.
<a href="https://github.com/icehawk/icehawk/blob/v2.0.4/src/Interfaces/RespondsFinallyToWriteRequest.php">RespondsFinallyToWriteRequest</a> interface.</p>
<p>These interfaces are basically the same and require a method named <code>handleUncaughtException()</code>. The only difference is the parameter type declaration
for the <code>$request</code> object that provides access to the current <a href="https://icehawk.github.io/docs/icehawk/request-information.html">request information</a> and
<a href="https://icehawk.github.io/docs/icehawk/request-input-data.html">request input data</a>.</p>
<pre><code class="language-php"># Read side method
public function handleUncaughtException( \Throwable $throwable, ProvidesReadRequestData $request )

# Write side method
public function handleUncaughtException( \Throwable $throwable, ProvidesWriteRequestData $request )</code></pre>
<p>The following example shows how your application could finally respond to an <a href="https://icehawk.github.io/docs/icehawk/exceptions.html"><code>UnresolvedRequest</code> exception</a>.</p>
<pre><code class="language-php">&lt;?php declare(strict_types=1);

namespace YourVendor\YourProject;

use IceHawk\IceHawk\Interfaces\RespondsFinallyToReadRequest;
use IceHawk\IceHawk\Interfaces\ProvidesReadRequestData;
use IceHawk\IceHawk\Exceptions\UnresolvedRequest;
use IceHawk\IceHawk\Constants\HttpCode;

final class YourFinalReadResponder implements RespondsFinallyToReadRequest
{
    public function handleUncaughtException( \Throwable $throwable, ProvidesReadRequestData $request )
    {
        try 
        {
            throw $throwable;
        }
        catch ( UnresolvedRequest $e )
        {
            # Handle unresolved requests and respond with HTTP/1.1 404 Not Found
            header( 'Content-Type: text/plain; charset=utf-8', true, HttpCode::NOT_FOUND );
            echo "404 - Not Found";
            flush();
        }
        catch ( \Throwable $e )
        {
            # Handle any other exception / error

            # Log the error
            $logMessage = sprintf(
                'Uncaught %s thrown in %s on line %s with message: %s',
                get_class($e),
                $e-&gt;getFile(),
                $e-&gt;getLine(),
                $e-&gt;getMessage()
            );

            error_log( $logMessage, 3, '/path/to/error.log' );

            # Respond with HTTP/1.1 500 Internal Server Error
            header( 'Content-Type: text/plain; charset=utf-8', true, HttpCode::INTERNAL_SERVER_ERROR );
            echo "500 - Internal Server Error";
            flush();
        }
    }
}</code></pre>
<p>As you can see you can decide what level of exceptions / errors you want to handle and how.</p>
<hr class="blockquote">
<h2>Why two final responders?</h2>
<p>You may wonder why we also separated the final responders for read and write requests. One reason is, that we wanted to handle especially write
requests in a different way than read requests. On a read request we can simply respond with an appropriate HTTP status code and error page like shown above.</p>
<p>If a write request throws an uncaught exception we don't want the user / client to re-submit that request over and over again, e.g. by hitting <kbd>F5</kbd>
in the browser, as this may causes more harm to our application or floods our error log. Instead we want to inform the user that something went wrong and respond with a redirect
to an appropriate error page - which is a read request responding directly with the correct headers and output. If the user / client refreshes now only
the read request is performed again, no data is submitted again to the server, no exception / error is produced again.</p>
<p>The following example shows how such a final write request responder could look like:</p>
<pre><code class="language-php">&lt;?php declare(strict_types=1);

namespace YourVendor\YourProject;

use IceHawk\IceHawk\Interfaces\RespondsFinallyToWriteRequest;
use IceHawk\IceHawk\Interfaces\ProvidesWriteRequestData;
use IceHawk\IceHawk\Constants\HttpCode;

final class YourFinalReadResponder implements RespondsFinallyToWriteRequest
{
    public function handleUncaughtException( \Throwable $throwable, ProvidesWriteRequestData $request )
    {
        try 
        {
            throw $throwable;
        }
        catch ( \Throwable $e )
        {
            # Handle any other exception / error

            # Log the error (once)
            $logMessage = sprintf(
                'Uncaught %s thrown in %s on line %s with message: %s',
                get_class($e),
                $e-&gt;getFile(),
                $e-&gt;getLine(),
                $e-&gt;getMessage()
            );

            error_log( $logMessage, 3, '/path/to/error.log' );

            # Respond with redirect to a 500 error page
            header( 'Location: /error/500', true, HttpCode::TEMPORARY_REDIRECT );
            flush();
        }
    }
}</code></pre>
				<div id="footer" class="row small">
					<div class="col-xs-2 col-sm-2 col-md-1 text-center">
						v1.0.0
					</div>
					<div class="col-xs-10 col-sm-10 col-md-3 text-center">
						<span class="text-muted">
							Generated with <a class="text-muted" href="https://github.com/icehawk/static-page-generator" target="_blank">
								IceHawk <abbr title="Static Page Generator">SPG</abbr>
							</a>
						</span>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<i class="fa fa-github text-muted"></i>
						<a href="https://github.com/icehawk" class="text-muted" target="_blank">Source code on github</a>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<i class="fa fa-comments-o text-muted"></i>
						<a href="https://gitter.im/icehawk/Lobby" class="text-muted" target="_blank">Chat with us on gitter</a>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-2 text-center">
						<i class="fa fa-exclamation-circle text-muted"></i>
						<a href="https://github.com/icehawk/icehawk.github.io/issues" class="text-muted" target="_blank">Report an issue</a>
					</div>
				</div>

			</div><!-- /.col-xs-12 main -->
		</div><!--/.row-->
	</div><!--/.container-->

	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://use.fontawesome.com/2add9a8fb5.js" async="async"></script>
	<script type="text/javascript" src="https://icehawk.github.io/js/prism.js" async="async"></script>
	<script type="text/javascript" src="https://icehawk.github.io/js/main.js" async="async"></script>
	
</div><!--/.page-container-->
</body>
</html>
