<!doctype html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<title>Events and subscribers | IceHawk | PHP micro-framework respecting CQRS</title>
	<meta name="description" content="IceHawk events and subscribers - components documentation">
	<meta name="keywords" content="IceHawk, event, subscriber, documentation">
	<meta name="HandheldFriendly" content="True"/>
	<meta name="geo.region" content="DE-SN"/>
	<meta name="geo.placename" content="Dresden"/>
	<meta name="geo.position" content="51.052088;13.741672"/>
	<meta name="ICBM" content="51.052088, 13.741672"/>
	<meta name="twitter:site" content="https://twitter.com/hollodotme">
	<meta name="twitter:creator" content="@hollodotme">
	<script type="application/ld+json">{
  "@context" : "http://schema.org",
  "@type": "Person",
  "name": "IceHawk framework",
  "image": "https://icehawk.github.io/images/logo_121x100.png",
  "url": "https://icehawk.github.io",
  "sameAs" : [
      "https://twitter.com/hollodotme",
      "https://www.xing.com/profile/Holger_Woltersdorf",
      "https://github.com/icehawk"
    ]
  }
}</script>
	<meta property="article:author" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<meta property="article:publisher" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<link rel="apple-touch-icon" sizes="57x57" href="https://icehawk.github.io/images/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="https://icehawk.github.io/images/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="https://icehawk.github.io/images/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://icehawk.github.io/images/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="https://icehawk.github.io/images/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://icehawk.github.io/images/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="https://icehawk.github.io/images/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://icehawk.github.io/images/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://icehawk.github.io/images/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192" href="https://icehawk.github.io/images/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://icehawk.github.io/images/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="https://icehawk.github.io/images/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://icehawk.github.io/images/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://icehawk.github.io/images/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="https://icehawk.github.io/images/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">
	<link rel="canonical" href="https://icehawk.github.io/docs/icehawk/events-and-subscribers.html"/>
	<meta name="referrer" content="origin"/>

	<meta property="og:site_name" content="IceHawk | PHP micro-framework respecting CQRS"/>
	<meta property="og:type" content="article"/>
	<meta property="og:title" content="Events and subscribers | IceHawk | PHP micro-framework respecting CQRS"/>
	<meta property="og:description" content="IceHawk events and subscribers - components documentation"/>
	<meta property="og:url" content="https://icehawk.github.io/docs/icehawk/events-and-subscribers.html"/>
	<meta property="og:image" content="https://icehawk.github.io/images/logo_121x100.png"/>
	<meta property="article:published_time" content="2016-11-14T22:05:31+01:00"/>
	<meta property="article:modified_time" content="2016-11-14T22:05:31+01:00"/>
			<meta property="article:tag" content="IceHawk"/>
			<meta property="article:tag" content="event"/>
			<meta property="article:tag" content="subscriber"/>
			<meta property="article:tag" content="documentation"/>
		<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:title" content="Events and subscribers | IceHawk | PHP micro-framework respecting CQRS"/>
	<meta name="twitter:description" content="IceHawk events and subscribers - components documentation"/>
	<meta name="twitter:url" content="https://icehawk.github.io/docs/icehawk/events-and-subscribers.html"/>
	<meta name="twitter:image:src" content="https://icehawk.github.io/images/logo_121x100.png"/>

	<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "IceHawk framework",
    "author": {
        "@type": "Person",
        "name": "Holger Woltersdorf",
        "image": "https://icehawk.github.io/images/hwoltersdorf.png",
        "url": "https://github.com/hollodotme",
        "sameAs": "https://twitter.com/hollodotme",
        "description": "CIO at Fortuneglobe GmbH, Head of Fortune Solutions, Husband, Father, PHP Dev with heart, board member of PHP USERGROUP DRESDEN e.V."
    },
    "headline": "Events and subscribers | IceHawk | PHP micro-framework respecting CQRS",
    "url": "https://icehawk.github.io/docs/icehawk/events-and-subscribers.html",
    "datePublished": "2016-11-14T22:05:31+01:00",
    "dateModified": "2016-11-14T22:05:31+01:00",
    "image": "https://icehawk.github.io/images/logo_121x100.png",
    "keywords": "IceHawk, event, subscriber, documentation",
    "description": "IceHawk events and subscribers - components documentation"
}</script>

	<meta name="generator" content="IceHawk Static Page Generator"/>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://icehawk.github.io/css/webfont.css">
	<link rel="stylesheet" href="https://icehawk.github.io/css/prism.css">
	<link rel="stylesheet" href="https://icehawk.github.io/css/main.css">
</head>
<body>

<div class="page-container">

	<!-- top navbar -->
	<a class="navbar-brand" href="/">
		<img alt="IceHawk" src="https://icehawk.github.io/images/logo_121x100.png">
	</a>
	<div id="top-navigation" role="navigation">
		<div class="container">
			<div class="left-nav">
				<h3 class="visible-xs visible-sm hidden-md hidden-lg">
					<a href="#" data-toggle="offcanvas" data-target=".sidebar-nav">
						<i class="fa fa-bars"></i>
					</a>
				</h3>
				<h1 class="h4 hidden-xs hidden-sm visible-md visible-lg">
					<span class="brand">IceHawk framework</span><br>
					<small>A micro-framework respecting CQRS - written for PHP 7</small>
				</h1>
			</div>
			<div class="right-nav text-right">
				<ul class="hidden-xs hidden-sm">
					<li>
						<a href="https://gitter.im/icehawk/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge" target="_blank" title="Join our chat on Gitter">
							<img src="https://badges.gitter.im/icehawk/icehawk.svg" class="img-responsive">
						</a>
					</li>
					<li>
						<a href="https://github.com/icehawk/icehawk.github.io" target="_blank">
							Help us improve the docs
						</a>
					</li>
					<li>
						<a href="https://github.com/icehawk" target="_blank" title="Source code on github">
							<i class="fa fa-github"></i>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div id="top-fader"></div>

	<div class="container">

		<div class="row hidden-xs hidden-sm">

			<div class="col-md-12 col-lg-12">
				<ul class="breadcrumb hidden-xs hidden-sm">
											<li>
							<a href="https://icehawk.github.io/index.html">Home</a>
						</li>
											<li>
							<a href="https://icehawk.github.io/docs.html">Documentation</a>
						</li>
											<li>
							<a href="https://icehawk.github.io/docs/icehawk.html">IceHawk</a>
						</li>
											<li class="active">
							<a href="https://icehawk.github.io/docs/icehawk/events-and-subscribers.html">Events and subscribers</a>
						</li>
									</ul>
			</div>

		</div>

		<div class="row row-offcanvas row-offcanvas-left">

			<!-- sidebar -->
			<div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
				<ul class="nav">
					
								<li class="active">
		<a href="https://icehawk.github.io/docs.html">Documentation</a>
					<ul class="nav">
															<li class="active">
		<a href="https://icehawk.github.io/docs/icehawk.html">IceHawk</a>
					<ul class="nav">
															<li>
		<a href="https://icehawk.github.io/docs/icehawk/installation.html">Installation</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/configuration.html">Configuration</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/delegation.html">Delegation</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/routing.html">Routing</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/request-information.html">Request information</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/request-input-data.html">Request input data</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/uploaded-files.html">Uploaded files</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/request-handlers.html">Request handlers</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/auto-responding.html">Auto responding</a>
			</li>

											<li class="active">
		<a href="https://icehawk.github.io/docs/icehawk/events-and-subscribers.html">Events and subscribers</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/exceptions.html">Exceptions</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/final-responding.html">Final responding</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/icehawk/constants.html">Constants</a>
			</li>

							</ul>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/session.html">Session</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/forms.html">Forms</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/pubsub.html">PubSub</a>
			</li>

							</ul>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/guides.html">Guides</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/coverage.html">Code coverage</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/metrics.html">Metrics</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/media.html">Media</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/imprint.html">Imprint</a>
			</li>


									</ul>
			</div>

			<!-- main area -->
			<div class="col-xs-12 col-sm-9" id="mainstage">

				<h1>IceHawk events and subscribers</h1>
<p>This section describes how to subscribe to and handle events that were emitted by the IceHawk component.</p>
<hr class="blockspace">
<h2>Events</h2>
<p>The IceHawk component emits the following events in the mentioned order.
The name of each event class implies the moment the event is emitted, because we always publish an event before and after an action takes resp. took place.</p>
<p>All event classes implement the <a href="https://github.com/icehawk/icehawk/blob/v2.0.4/src/PubSub/Interfaces/CarriesEventData.php">CarriesEventData</a>
interface that guaranties a getter named <code>getRequestInfo()</code> to retrieve the current <a href="https://icehawk.github.io/docs/icehawk/request-information.html">request info object</a>.</p>
<h3>1. InitializingIceHawkEvent</h3>
<p>This event is published whithin the <code>IceHawk::init()</code> method, after the <a href="https://icehawk.github.io/docs/icehawk/configuration.html">ConfiguresIceHawk::setUpGlobalVars()</a> is called, but before
<a href="https://icehawk.github.io/docs/icehawk/configuration.html">ConfiguresIceHawk::setUpErrorHandling()</a> and <a href="https://icehawk.github.io/docs/icehawk/configuration.html">ConfiguresIceHawk::setUpSessionHandling()</a> are called.  </p>
<p>The event carries the current <a href="https://icehawk.github.io/docs/icehawk/request-information.html">request info object</a>.</p>
<h3>2. IceHawkWasInitializedEvent</h3>
<p>This event is published whithin the <code>IceHawk::init()</code> method, after
<a href="https://icehawk.github.io/docs/icehawk/configuration.html">ConfiguresIceHawk::setUpErrorHandling()</a> and <a href="https://icehawk.github.io/docs/icehawk/configuration.html">ConfiguresIceHawk::setUpSessionHandling()</a> were executed.  </p>
<p>The event carries the current <a href="https://icehawk.github.io/docs/icehawk/request-information.html">request info object</a>.</p>
<h3>3. HandlingReadRequestEvent / HandlingWriteRequestEvent</h3>
<p>This event is published within the <code>IceHawk::handleRequest()</code> method after the route was resolved, but before the actual request handler's <code>handle()</code>
method is called.</p>
<p>If the current request is a read request (HTTP methods GET or HEAD), the <code>HandlingReadRequestEvent</code> will be emitted. If the current request is a write
request (HTTP methods POST, PUT, PATCH, DELETE), the <code>HandlingWriteRequestEvent</code> will be emitted.</p>
<p>The event carries the current request object including <a href="https://icehawk.github.io/docs/icehawk/request-information.html">request info</a> and
<a href="https://icehawk.github.io/docs/icehawk/request-input-data.html">request input data</a> objects.</p>
<h3>4. ReadRequestWasHandled / WriteRequestWasHandled</h3>
<p>This event is published within the <code>IceHawk::handleRequest()</code> method after the actual request handler's <code>handle()</code> method was executed.</p>
<p>If the current request is a read request (HTTP methods GET or HEAD), the <code>ReadRequestWasHandledEvent</code> will be emitted. If the current request is a write
request (HTTP methods POST, PUT, PATCH, DELETE), the <code>WriteRequestWasHandledEvent</code> will be emitted.</p>
<p>The event carries the current request object including <a href="https://icehawk.github.io/docs/icehawk/request-information.html">request info</a> and
<a href="https://icehawk.github.io/docs/icehawk/request-input-data.html">request input data</a> objects.</p>
<hr class="blockspace">
<h2>Event subscribers</h2>
<p>An event subscriber needs to implement the <a href="https://github.com/icehawk/icehawk/blob/v2.0.4/src/PubSub/Interfaces/SubscribesToEvents.php">SubscribesToEvents</a>
interface. This interface has two methods:</p>
<pre><code class="language-php">public function acceptsEvent( CarriesEventData $event ) : bool</code></pre>
<p>This method shall return a boolean whether the passed event is accepted by this subscriber or not.</p>
<pre><code class="language-php">public function notify( CarriesEventData $event )</code></pre>
<p>If the subscriber accepts the current event, this method is called and gets the current event passed. </p>
<p>The intention of the <code>notify()</code> method is to call your business logic for the passed event.</p>
<hr class="blockspace">
<h2>Implementing event subscribers</h2>
<p>One way to implement an event subscriber is of course to write a class that implements the <code>SubscribesToEvents</code> interface and do the handling
all on your own.</p>
<p>To help you out with the handling the IceHawk ships with an <a href="https://github.com/icehawk/icehawk/blob/v2.0.4/src/PubSub/AbstractEventSubscriber.php">abstract event subscriber</a>
class, that requires you to simply return the accepted event class names and to implement a protected/public event handler method. </p>
<p>An example implementation for an event subscriber for the <code>IceHawkWasInitializedEvent</code> would look like this:</p>
<pre><code class="language-php">&lt;?php declare(strict_types=1);

namespace YourVendor\YourProject;

use IceHawk\IceHawk\PubSub\AbstractEventSubscriber;
use IceHawk\IceHawk\Events\IceHawkWasInitializedEvent;

final class YourEventSubscriber extends AbstractEventSubscriber
{
    public function getAcceptedEvents() : array
    {
        return [
            IceHawkWasInitializedEvent::class,
        ];
    }

    protected function whenIceHawkWasInitialized( IceHawkWasInitializedEvent $event )
    {
        echo "IceHawk was initialized with request URI: " . $event-&gt;getRequestInfo()-&gt;getUri();
    }
}</code></pre>
<p>As you can see the abstract event subscriber drills down the <code>acceptsEvent()</code> method to a simple question for event class names (<code>getAcceptedEvents()</code>).
Furthermore it tries to call a method named after the event class on the event subscriber - the event handler method. (when <code>notify()</code> is called)</p>
<p>The name of the event handler method has the prefix &quot;when&quot; to describe that it is called <em>when</em> the subscriber is notified about the event, while the
&quot;Event&quot; suffix is omitted in the method name. Furthermore the concrete event class name is used as the parameter type declaration
to express that this handler method is only responsible for this particular event.</p>
<p>Using the <code>AbstractEventSubscriber</code> class lets you easily implement one subscriber for multiple events.
The following example shows how to measure the time your request handler needs to handle the current request by implementing one subscriber for two events.</p>
<pre><code class="language-php">&lt;?php declare(strict_types=1);

namespace YourVendor\YourProject;

use IceHawk\IceHawk\PubSub\AbstractEventSubscriber;
use IceHawk\IceHawk\Events\HandlingReadRequestEvent;
use IceHawk\IceHawk\Events\ReadRequestWasHandled;

final class YourEventSubscriber extends AbstractEventSubscriber
{
    /** @var float */
    private $startTime;

    public function getAcceptedEvents() : array
    {
        return [
            HandlingReadRequestEvent::class,
            ReadRequestWasHandledEvent::class,
        ];
    }

    protected function whenHandlingReadRequest( HandlingReadRequestEvent $event )
    {
        $this-&gt;startTime = microtime(true);
    }

    protected function whenReadRequestWasHandled( ReadRequestWasHandledEvent $event )
    {
        # Print the duration your request handler took to handle the request
        printf( 
            "Your request handler took %f seconds to handle the request on URI: %s",
            (microtime(true) - $this-&gt;startTime),
            $event-&gt;getRequestInfo()-&gt;getUri()
        );

        # Print the overall duration since the request hit the server
        printf(
            "IceHawk handled the request in %f seconds.",
            (microtime(true) - $event-&gt;getRequestInfo()-&gt;getRequestTimeFloat())
        );
    }
}</code></pre>
<p><strong>Please note:</strong> If your subscriber claims to accept a particular event, but does not implement its accordingly event handler method,
the abstract event subscriber will <a href="https://icehawk.github.io/docs/icehawk/exceptions.html">throw an <code>EventHandlerMethodNotImplemented</code> exception</a>.
This is of course not the case, if you only implement the <code>SubscribesToEvents</code> interface.</p>
<p>When using the abstract event subscriber class the event handler method must be <em>callable</em> from its scope.
It therefor needs to be declared <code>protected</code> or <code>public</code>.</p>
<hr class="blockspace">
<h2>Registering event subscribers</h2>
<p>You can register your event subscribers in the <a href="https://icehawk.github.io/docs/icehawk/configuration.html">IceHawk config's <code>getEventSubscribers()</code> method</a> by simply
returning an array of event subscriber instances.</p>
<p>You can of course register multiple event subscribers for one event. The order in which the subscribers will be notified about the event is the same
as the registration order.</p>
<pre><code class="language-php">&lt;?php declare(strict_types=1);

namespace YourVendor\YourProject;

use IceHawk\IceHawk\Interfaces\ConfiguresIceHawk;

final class IceHawkConfig implements ConfiguresIceHawk
{
    # ...

    public function getEventSubscribers() : array
    {
        return [
            new YourEventSubscriber(),  
        ];
    }
}</code></pre>
<p><strong>Please note:</strong> The IceHawk component makes sure that the event subscribers were instantiated only once.</p>
				<div id="footer" class="row small">
					<div class="col-xs-2 col-sm-2 col-md-1 text-center">
						v1.0.0
					</div>
					<div class="col-xs-10 col-sm-10 col-md-3 text-center">
						<span class="text-muted">
							Generated with <a class="text-muted" href="https://github.com/icehawk/static-page-generator" target="_blank">
								IceHawk <abbr title="Static Page Generator">SPG</abbr>
							</a>
						</span>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<i class="fa fa-github text-muted"></i>
						<a href="https://github.com/icehawk" class="text-muted" target="_blank">Source code on github</a>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<i class="fa fa-comments-o text-muted"></i>
						<a href="https://gitter.im/icehawk/Lobby" class="text-muted" target="_blank">Chat with us on gitter</a>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-2 text-center">
						<i class="fa fa-exclamation-circle text-muted"></i>
						<a href="https://github.com/icehawk/icehawk.github.io/issues" class="text-muted" target="_blank">Report an issue</a>
					</div>
				</div>

			</div><!-- /.col-xs-12 main -->
		</div><!--/.row-->
	</div><!--/.container-->

	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://use.fontawesome.com/2add9a8fb5.js" async="async"></script>
	<script type="text/javascript" src="https://icehawk.github.io/js/prism.js" async="async"></script>
	<script type="text/javascript" src="https://icehawk.github.io/js/main.js" async="async"></script>
	
</div><!--/.page-container-->
</body>
</html>
