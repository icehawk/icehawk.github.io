<!doctype html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<title>PubSub component | IceHawk | PHP micro framework respecting CQRS</title>
	<meta name="description" content="PubSub - components documentation">
	<meta name="keywords" content="publish, subscribe, pubsub, components, applications, routing, documentation">
	<meta name="HandheldFriendly" content="True"/>
	<meta name="geo.region" content="DE-SN"/>
	<meta name="geo.placename" content="Dresden"/>
	<meta name="geo.position" content="51.052088;13.741672"/>
	<meta name="ICBM" content="51.052088, 13.741672"/>
	<meta name="twitter:site" content="https://twitter.com/hollodotme">
	<meta name="twitter:creator" content="@hollodotme">
	<script type="application/ld+json">{
  "@context" : "http://schema.org",
  "@type": "Person",
  "name": "IceHawk framework",
  "image": "https://icehawk.github.io/images/logo_121x100.png",
  "url": "https://icehawk.github.io",
  "sameAs" : [
      "https://twitter.com/hollodotme",
      "https://www.xing.com/profile/Holger_Woltersdorf",
      "https://github.com/icehawk"
    ]
  }
}</script>
	<meta property="article:author" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<meta property="article:publisher" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<link rel="apple-touch-icon" sizes="57x57" href="https://icehawk.github.io/images/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="https://icehawk.github.io/images/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="https://icehawk.github.io/images/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://icehawk.github.io/images/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="https://icehawk.github.io/images/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://icehawk.github.io/images/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="https://icehawk.github.io/images/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://icehawk.github.io/images/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://icehawk.github.io/images/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192" href="https://icehawk.github.io/images/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://icehawk.github.io/images/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="https://icehawk.github.io/images/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://icehawk.github.io/images/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://icehawk.github.io/images/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="https://icehawk.github.io/images/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">
	<link rel="canonical" href="https://icehawk.github.io/docs/pubsub.html"/>
	<meta name="referrer" content="origin"/>

	<meta property="og:site_name" content="IceHawk | PHP micro framework respecting CQRS"/>
	<meta property="og:type" content="article"/>
	<meta property="og:title" content="PubSub component | IceHawk | PHP micro framework respecting CQRS"/>
	<meta property="og:description" content="PubSub - components documentation"/>
	<meta property="og:url" content="https://icehawk.github.io/docs/pubsub.html"/>
	<meta property="og:image" content="https://icehawk.github.io/images/logo_121x100.png"/>
	<meta property="article:published_time" content="2016-11-03T01:03:34+01:00"/>
	<meta property="article:modified_time" content="2016-11-03T01:03:34+01:00"/>
			<meta property="article:tag" content="publish"/>
			<meta property="article:tag" content="subscribe"/>
			<meta property="article:tag" content="pubsub"/>
			<meta property="article:tag" content="components"/>
			<meta property="article:tag" content="applications"/>
			<meta property="article:tag" content="routing"/>
			<meta property="article:tag" content="documentation"/>
		<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:title" content="PubSub component | IceHawk | PHP micro framework respecting CQRS"/>
	<meta name="twitter:description" content="PubSub - components documentation"/>
	<meta name="twitter:url" content="https://icehawk.github.io/docs/pubsub.html"/>
	<meta name="twitter:image:src" content="https://icehawk.github.io/images/logo_121x100.png"/>

	<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "IceHawk framework",
    "author": {
        "@type": "Person",
        "name": "Holger Woltersdorf",
        "image": "https://icehawk.github.io/images/hwoltersdorf.png",
        "url": "https://github.com/hollodotme",
        "sameAs": "https://twitter.com/hollodotme",
        "description": "CIO at Fortuneglobe GmbH, Head of Fortune Solutions, Husband, Father, PHP Dev with heart, board member of PHP USERGROUP DRESDEN e.V."
    },
    "headline": "PubSub component | IceHawk | PHP micro framework respecting CQRS",
    "url": "https://icehawk.github.io/docs/pubsub.html",
    "datePublished": "2016-11-03T01:03:34+01:00",
    "dateModified": "2016-11-03T01:03:34+01:00",
    "image": "https://icehawk.github.io/images/logo_121x100.png",
    "keywords": "publish, subscribe, pubsub, components, applications, routing, documentation",
    "description": "PubSub - components documentation"
}</script>

	<meta name="generator" content="IceHawk Static Page Generator"/>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://icehawk.github.io/css/webfont.css">
	<link rel="stylesheet" href="https://icehawk.github.io/css/prism.css">
	<link rel="stylesheet" href="https://icehawk.github.io/css/main.css">
</head>
<body>

<div class="page-container">

	<!-- top navbar -->
	<a class="navbar-brand" href="/">
		<img alt="IceHawk" src="https://icehawk.github.io/images/logo_121x100.png">
	</a>
	<div id="top-navigation" role="navigation">
		<div class="container">
			<div class="left-nav">
				<h3 class="visible-xs visible-sm hidden-md hidden-lg">
					<a href="#" data-toggle="offcanvas" data-target=".sidebar-nav">
						<i class="fa fa-bars"></i>
					</a>
				</h3>
				<h1 class="h4 hidden-xs hidden-sm visible-md visible-lg">
					<span class="brand">IceHawk framework</span><br>
					<small>A micro-framework respecting CQRS - written for PHP 7</small>
				</h1>
			</div>
			<div class="right-nav text-right">
				<ul class="hidden-xs hidden-sm">
					<li>
						<a href="https://gitter.im/icehawk/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge" target="_blank" title="Join our chat on Gitter">
							<img src="https://badges.gitter.im/icehawk/icehawk.svg" class="img-responsive">
						</a>
					</li>
					<li>
						<a href="https://github.com/icehawk/icehawk.github.io" target="_blank">
							Help us improve the docs
						</a>
					</li>
					<li>
						<a href="https://github.com/icehawk" target="_blank" title="Source code on github">
							<i class="fa fa-github"></i>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div id="top-fader"></div>

	<div class="container">

		<div class="row hidden-xs hidden-sm">

			<div class="col-md-12 col-lg-12">
				<ul class="breadcrumb hidden-xs hidden-sm">
											<li>
							<a href="https://icehawk.github.io/index.html">Home</a>
						</li>
											<li>
							<a href="https://icehawk.github.io/docs.html">Documentation</a>
						</li>
											<li class="active">
							<a href="https://icehawk.github.io/docs/pubsub.html">PubSub</a>
						</li>
									</ul>
			</div>

		</div>

		<div class="row row-offcanvas row-offcanvas-left">

			<!-- sidebar -->
			<div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
				<ul class="nav">
					
								<li class="active">
		<a href="https://icehawk.github.io/docs.html">Documentation</a>
					<ul class="nav">
															<li>
		<a href="https://icehawk.github.io/docs/icehawk.html">IceHawk</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/session.html">Session</a>
			</li>

											<li>
		<a href="https://icehawk.github.io/docs/forms.html">Forms</a>
			</li>

											<li class="active">
		<a href="https://icehawk.github.io/docs/pubsub.html">PubSub</a>
			</li>

							</ul>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/coverage.html">Code coverage</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/metrics.html">Metrics</a>
			</li>


					
								<li>
		<a href="https://icehawk.github.io/media.html">Media</a>
			</li>


									</ul>
			</div>

			<!-- main area -->
			<div class="col-xs-12 col-sm-9" id="mainstage">

				<h1>PubSub component</h1>
<p>Provides infrastructure for publishing messages to a channel and subscribing to a channel.</p>
<hr class="blockspace">
<h2>Create a message</h2>
<p><strong>Please note:</strong> </p>
<ul>
<li>Messages should always be immutable.</li>
<li>Every message MUST have a:
<ul>
<li>Message ID</li>
<li>Message name</li>
</ul></li>
</ul>
<p>... and of course user-defined content, so called payload. </p>
<p>IceHawk/PubSub shipps with 2 types/value objects for the message ID and message name.
If you don't want / can't use them for any reason, you can alternativly implement their interfaces.</p>
<table>
<thead>
<tr>
<th>Shipped type / value object</th>
<th>Interface</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IceHawk\PubSub\Types\MessageId</code></td>
<td><code>IceHawk\PubSub\Interfaces\IdentifiesMessage</code></td>
</tr>
<tr>
<td><code>IceHawk\PubSub\Types\MessageName</code></td>
<td><code>IceHawk\PubSub\Interfaces\NamesMessage</code></td>
</tr>
</tbody>
</table>
<p>The message itself MUST implement the following interface:</p>
<p><code>IceHawk\PubSub\Interfaces\CarriesInformation</code></p>
<p>So a message implementation could look like this:</p>
<pre><code class="language-php">&lt;?php

namespace YourVendor\YourProject;

use IceHawk\PubSub\Interfaces\CarriesInformation;
use IceHawk\PubSub\Interfaces\IdentifiesMessage;
use IceHawk\PubSub\Interfaces\NamesMessage;

final class YourMessage implements CarriesInformation
{
    /** @var IdentifiesMessage */
    private $messageId;

    /** @var NamesMessage */
    private $messageName;

    /** @var string */
    private $content;

    public function __construct( IdentifiesMessage $messageId, NamesMessage $messageName, string $content ) 
    {
        $this-&gt;messageId    = $messageId;
        $this-&gt;messageName  = $messageName;
        $this-&gt;content      = $content;
    }

    public function getMessageId() : IdentifiesMessage 
    {
        return $this-&gt;messageId;
    }

    public function getMessageName() : NamesMessage 
    {
        return $this-&gt;messageName;
    }

    public function getContent() : string
    {
        return $this-&gt;content;
    }
}</code></pre>
<p>And a new instance of this message is created like this:</p>
<pre><code class="language-php">&lt;?php

namespace YourVendor\YourProject;

use IceHawk\PubSub\Types\MessageId;
use IceHawk\PubSub\Types\MessageName;

$yourMessage = new YourMessage( 
    new MessageId( '123456-ABC-789' ),
    new MessageName( 'Something had happened' ),
    'Hello World!' 
);</code></pre>
<hr class="blockspace">
<h2>Create a message subscriber</h2>
<p>To implement a subscriber that gets notified about all messages published to the channel it is subscribing to,
you can extend the <code>AbstractMessageSubscriber</code> class that is shipped with IceHawk\PubSub.</p>
<p>The <code>AbstractMessageSubscriber</code> class automatically converts the message name to a handler method name by prefixing <code>when</code> to the message name,
which is converted to upper camelcase. (All non-alphanumeric characters are removed.)
In this example: The message name &quot;Something had happened&quot; becomes the handler method name &quot;whenSomethingHadHappened&quot;.</p>
<p>As the invocation to the handler method is triggered by the abstract parent class, the method must at least have protected (or public) visibility.
Private methods would not be callable, because they would be out of the parent class' scope.</p>
<p>The handler methods gets invoked with 2 parameters:</p>
<ol>
<li>The published message instance</li>
<li>The channel instance the message was published on</li>
</ol>
<p>IceHawk\PubSub shipps with a type/value object for channels.
If you don't want / can't use it for any reason, you can alternativly implement its interfaces.</p>
<table>
<thead>
<tr>
<th>Shipped type / value object</th>
<th>Interface</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IceHawk\PubSub\Types\Channel</code></td>
<td><code>IceHawk\PubSub\Interfaces\IdentifiesChannel</code></td>
</tr>
</tbody>
</table>
<p>The alternative to extend the <code>AbstractMessageSubscriber</code> class is to implement the following interface:</p>
<p><code>IceHawk\PubSub\Interfaces\SubscribesToMessages</code></p>
<p>A basic implementation of a subscriber, being notified about the previously created message, could look like this:</p>
<pre><code class="language-php">&lt;?php

namespace YourVendor\YourProject;

use IceHawk\PubSub\AbstractMessageSubscriber;
use IceHawk\PubSub\Types\Channel;

final class YourSubscriber extends AbstractMessageSubscriber
{
    protected function whenSomethingHadHappened( YourMessage $yourMessage, Channel $channel )
    {
        printf(
            'Message named "%s" with ID "%s" was published on channel "%" with content: "%s"',
            $yourMessage-&gt;getMessageName(),
            $yourMessage-&gt;getMessageId(),
            $channel,
            $yourMessage-&gt;getContent()
        );
    }
}</code></pre>
<hr class="blockspace">
<h2>Subscribe to a channel</h2>
<pre><code class="language-php">&lt;?php

namespace YourVendor\YourProject;

use IceHawk\PubSub\MessageBus;
use IceHawk\PubSub\Types\Channel;

// ...

$messageBus = new MessageBus();
$messageBus-&gt;subscribe( new Channel( 'ListenToMe' ), new YourSubscriber() );
</code></pre>
<p><strong>Note:</strong> The <code>MessageBus</code> class automatically prevents subscribing of equal subscribers to the same channel.
But one subscriber can subscribe to multiple channels.</p>
<hr class="blockspace">
<h2>Publish a message</h2>
<p>In the same way you subscribe to a channel, you will publish a message to a channel like this:</p>
<pre><code class="language-php">&lt;?php

namespace YourVendor\YourProject;

use IceHawk\PubSub\Types\Channel;

// ...

$messageBus-&gt;publish( new Channel('ListenToMe'), $yourMessage );
</code></pre>
<p><strong>Prints:</strong></p>
<pre><code>Message named "Something had happened" with ID "123456-ABC-789" was published on channel "ListenToMe" with content: "Hello World!"'</code></pre>
				<div id="footer" class="row small">
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<span class="text-muted">
							Generated with <a class="text-muted" href="https://github.com/icehawk/static-page-generator" target="_blank">
								IceHawk <abbr title="Static Page Generator">SPG</abbr>
							</a>
						</span>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<i class="fa fa-github text-muted"></i>
						<a href="https://github.com/icehawk" class="text-muted" target="_blank">Source code on github</a>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<i class="fa fa-comments-o text-muted"></i>
						<a href="https://gitter.im/icehawk/Lobby" class="text-muted" target="_blank">Chat with us on gitter</a>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-3 text-center">
						<i class="fa fa-exclamation-circle text-muted"></i>
						<a href="https://github.com/icehawk/icehawk.github.io/issues" class="text-muted" target="_blank">Report an issue</a>
					</div>
				</div>

			</div><!-- /.col-xs-12 main -->
		</div><!--/.row-->
	</div><!--/.container-->

	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://use.fontawesome.com/2add9a8fb5.js" async="async"></script>
	<script type="text/javascript" src="https://icehawk.github.io/js/prism.js" async="async"></script>
	<script type="text/javascript" src="https://icehawk.github.io/js/main.js" async="async"></script>
	
</div><!--/.page-container-->
</body>
</html>
